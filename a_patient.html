<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Patient</title>

	<!-- Global stylesheets -->
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900" rel="stylesheet" type="text/css">
	<link href="global_assets/css/icons/icomoon/styles.min.css" rel="stylesheet" type="text/css">
	<link href="assets/css/all.min.css" rel="stylesheet" type="text/css">
	<link href="assets/css/styles.css" rel="stylesheet" type="text/css">
	<!-- /global stylesheets -->

	<!-- Core JS files -->
	<script src="global_assets/js/main/jquery.min.js"></script>
	<script src="global_assets/js/main/bootstrap.bundle.min.js"></script>
	<!-- /core JS files -->

	<!-- Theme JS files --> 

	
	<script src="global_assets/js/plugins/visualization/d3/d3.min.js"></script>
	<script src="global_assets/js/plugins/visualization/d3/d3_tooltip.js"></script>
	<script src="global_assets/js/plugins/ui/moment/moment.min.js"></script>
	<script src="global_assets/js/plugins/pickers/daterangepicker.js"></script>

	<script src="assets/js/app.js"></script>
	<script src="global_assets/js/demo_pages/dashboard.js"></script>
	<script src="global_assets/js/demo_charts/pages/dashboard/light/streamgraph.js"></script>
	<script src="global_assets/js/demo_charts/pages/dashboard/light/sparklines.js"></script>
	<script src="global_assets/js/demo_charts/pages/dashboard/light/lines.js"></script>	
	<script src="global_assets/js/demo_charts/pages/dashboard/light/areas.js"></script>
	<script src="global_assets/js/demo_charts/pages/dashboard/light/donuts.js"></script>
	<script src="global_assets/js/demo_charts/pages/dashboard/light/bars.js"></script>
	<script src="global_assets/js/demo_charts/pages/dashboard/light/progress.js"></script>
	<script src="global_assets/js/demo_charts/pages/dashboard/light/heatmaps.js"></script>
	<script src="global_assets/js/demo_charts/pages/dashboard/light/pies.js"></script>
	<script src="global_assets/js/demo_charts/pages/dashboard/light/bullets.js"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

	<script src="global_assets/js/plugins/extensions/jquery_ui/interactions.min.js"></script>
	<script src="global_assets/js/plugins/forms/selects/select2.min.js"></script>
	<script src="global_assets/js/demo_pages/form_select2.js"></script>

	<script src="global_assets/js/demo_pages/form_input_groups.js"></script>
	<script src="global_assets/js/plugins/forms/inputs/touchspin.min.js"></script>

	<!-- swal - sweet alert library -->
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

	<!-- /theme JS files -->

</head>

<body>

	<!-- Main navbar -->
	<div class="navbar navbar-expand-lg navbar-dark navbar-static" style="background-color: rgb(89, 5, 168);">
		<div class="d-flex flex-1 d-lg-none">
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-mobile">
				<i class="icon-paragraph-justify3"></i>
				<span class="badge badge-mark border-warning m-1"></span>
			</button>
		</div>

		<div class="navbar-brand wmin-0 mr-lg-5">
			<a id="header-patient-name" href="index.html" class="d-inline-block"></a>
		</div>

		<div class="navbar-brand wmin-0 mr-lg-5">
			<a href="index.html" class="d-inline-block">
				<img src="global_assets/images/logo_light.png" class="d-none d-sm-block" alt="">
				<img src="global_assets/images/logo_icon_light.png" class="d-sm-none" alt="">
			</a>
		</div>

		<div class="collapse navbar-collapse order-2 order-lg-1" id="navbar-mobile">
			<ul class="navbar-nav">

			</ul>
		</div>

	</div>
	<!-- /main navbar -->


	<!-- Footer navbar -->
	<div id="footer" class="navbar navbar-expand navbar-light px-0 px-lg-3">
		<div class="overflow-auto overflow-lg-visible scrollbar-hidden flex-1">
			<ul id="footer-ul" class="navbar-nav flex-row text-nowrap">
				<li id="footer-item" class="nav-item">
					<a href="index.html" class="navbar-nav-link active">
						<i id="footer-icon" class="icon-user mr-2"></i>
					</a>
				</li>	
				<li id="footer-item" class="nav-item">
					<a href="#" class="navbar-nav-link active">
						<i id="footer-icon" class="icon-aid-kit mr-2"></i>
					</a>
				</li>	
				<li id="footer-item" class="nav-item">
					<a href="index.html" class="navbar-nav-link active">
						<i id="footer-icon" class="icon-stack-text mr-2"></i>
					</a>
				</li>	
				<li id="footer-item" class="nav-item">
					<a href="index.html" class="navbar-nav-link active">
						<i id="footer-icon" class="icon-file-plus mr-2"></i>
					</a>
				</li>	
				<li id="footer-item" class="nav-item">
					<a href="index.html" class="navbar-nav-link active">
						<i id="footer-icon" class="icon-users2 mr-2"></i>
					</a>
				</li>					
			</ul>
		</div>
	</div>
	<!-- /secondary navbar -->
		

	<!-- Page content -->
	</br>

	<div class="page-content pt-0">

		<!-- Main content -->
		<div class="content-wrapper">

			<!-- Content area -->
			<div class="content">

				<!-- Main charts -->
				<div class="row">
					<div class="col-xl-7" >

						<!-- Horizontal form -->
						<div id="card" class="card" style="box-shadow: 10px 5px rgb(89, 5, 168);">
							<div class="card-header header-elements-inline">
							</div>

							<div class="collapse show">
								<div class="card-body">
										<div class="form-group row">
											<label id="page-two-patient-name" class="col-lg-3 col-form-label">Name :</label>
										</div>

										<div id="gender-lable" class="form-group row">
											<label id="page-two-patient-gender" class="col-lg-3 col-form-label">Gender: </label>
										</div>

										<div id="age-lable" class="form-group row">
											<label id="page-two-patient-age" class="col-lg-3 col-form-label">Age: </label>
										</div>
								</div>
							</div>
						</div>
						<!-- /horizotal form -->

					</div>

					<div id="drug-update-redirect-div"></div>

					<!-- middle navbar -->
					<div id="middle-navbar" class="navbar navbar-expand navbar-light px-0 px-lg-3">
						<div class="overflow-auto overflow-lg-visible scrollbar-hidden flex-1">
							<ul class="navbar-nav flex-row text-nowrap">
								<li id="footer-item" class="nav-item">
									<a href="index.html" class="navbar-nav-link active">
										<i id="footer-icon" class="icon-pulse2 mr-2"></i>
									</a>
								</li>	
								<li id="footer-item" class="nav-item">
									<a href="index.html" class="navbar-nav-link active">
										<i id="footer-icon" class="icon-list-numbered mr-2"></i>
									</a>
								</li>	
								<li id="footer-item" class="nav-item">
									<a href="index.html" class="navbar-nav-link active">
										<i id="footer-icon" class="icon-newspaper mr-2"></i>
									</a>
								</li>	
								<li id="footer-item" class="nav-item">
									<a href="index.html" class="navbar-nav-link active">
										<i id="footer-icon" class="icon-history mr-2"></i>
									</a>
								</li>						
							</ul>
						</div>
					</div>
					<!-- /middle navbar -->
		

					<div class="col-xl-5">

						<!-- Sales stats -->
						<div id="card" class="card">

							<div class="card">	
								<div class="card-body">
									<ul id="tab-body" class="nav nav-tabs nav-tabs-bottom nav-justified">
										<li id="drugs-button" class="nav-item"><a href="#justified-right-icon-tab2" class="nav-link active" data-toggle="tab">Drug<i id="tab-lable" class="icon-folder-plus3 ml-2"></i></a></li>
										<li id="tests-button" class="nav-item"><a href="#justified-right-icon-tab2" class="nav-link" data-toggle="tab">Test<i id="tab-lable" class="icon-folder-check ml-2"></i></a></li>
										<li id="procedures-button" class="nav-item"><a href="#justified-right-icon-tab2" class="nav-link" data-toggle="tab">Procedure<i id="tab-lable" class="icon-paste2 ml-2"></i></a></li>
										<li id="therapy-button" class="nav-item"><a href="#justified-right-icon-tab2" class="nav-link" data-toggle="tab">Therapy <i id="tab-lable" class="icon-magic-wand ml-2"></i></a></li>
									</ul>
								</div>
							</div>
								
							<div>
								<!-- Horizontal form -->
								<div class="collapse show" id="drugs-box">
									<form id="drug-details-form">
										<div class="card-body py-0">
											</br>
											<div class="form-group row">
												<label id="card-label-first" class="col-lg-3 col-form-label">Drug</label>
												<div class="col-lg-9">
													<input  id="drug-data" list="drug-list" type="text" class="form-control" placeholder="Search Drug">
													<datalist id="drug-list">
													</datalist>
												</div>
											</div>

											<div class="form-group row">
												<label id="card-label" class="col-lg-3 col-form-label">Dose</label>
												<div class="col-lg-9">
													<input  id="dose-data" type="number" class="form-control" placeholder="Select">
												</div>
											</div>

											<div class="form-group row">
												<label id="card-label" class="col-lg-3 col-form-label">Frequent </label> <!-- Frequent  = freq (if there is something with named "freq", that should be "Frequent") -->
												<div class="col-lg-9">
													<input  id="freq-data" list="freq-list" type="text" class="form-control" placeholder="Select">
													<datalist id="freq-list">
														<option value="bd">bd</option>
														<option value="tds">tds</option>
														<option value="mane">mane</option>
														<option value="nocte">nocte</option>
														<option value="qds">qds</option>
														<option value="daily">daily</option>
														<option value="sos">sos</option>
														<option value="eod">eod</option>
														<option value="stat">stat</option>
													</datalist>
												</div>
											</div>

											<div class="form-group row">
												<label id="card-label" class="col-lg-3 col-form-label">Duration</label> <!-- Duration = due (if there is something with named "due", that should be "Duration") -->
												<div class="col-lg-9">
													<input  id="due-data" type="number" class="form-control" placeholder="Select">
												</div>
											</div>
										</div>	
										<div class="text-center">
											<button id="add-drug-button" type="submit" class="btn btn-primary" style="background-color: rgb(89, 5, 168);">Add Drug<i class="icon-paperplane ml-2"></i></button>
										</div>
									</form>
									<br/>
								</div>

								<div class="collapse show" id="tests-box">
									<form id="test-details-form">
										<div class="card-body py-0">
											</br>
											<div class="form-group row">
												<label id="card-label-first" class="col-lg-3 col-form-label">Test Type</label>
												<div class="col-lg-9">
													<input  id="test-data" list="test-list" type="text" class="form-control" placeholder="Search Drug">
													<datalist id="test-list">
													</datalist>
												</div>
											</div>

											<div class="form-group row">
												<label id="card-label" class="col-lg-3 col-form-label">Subcategory</label>
												<div class="col-lg-9">
													<input  id="test-subcategory-data" list="sub-test-list" type="text" class="form-control" placeholder="Select">
													<datalist id="sub-test-list">
													</datalist>
												</div>
											</div>

											<div class="form-group row">
												<label id="card-label" class="col-lg-3 col-form-label">Comments</label>
												<div class="col-lg-9">
													<input  id="test-comments-data" type="text" class="form-control" placeholder="Comments">
												</div>
											</div>
		
										<div class="text-center">
											<button id="add-test-button" type="submit" class="btn btn-primary" style="background-color: rgb(89, 5, 168);">Add Test<i class="icon-paperplane ml-2"></i></button>
										</div>
									</form>
									<br/>
								</div>
								<!-- /horizotal form -->
							</div>
							<!-- /sales stats -->

							<div class="collapse show" id="procedures-box">
								<form id="procedure-details-form">
									<div class="card-body py-0">
										</br>
										<div class="form-group row">
											<label id="card-label-first" class="col-lg-3 col-form-label">Procedure</label>
											<div class="col-lg-9">
												<input  id="procedures-data" list="procedures-list" type="text" class="form-control" placeholder="Search Procedure">
												<datalist id="procedures-list">
													<option value="Common Test">Common Test</option>
													<option value="Favorite">Favorite</option>
													<option value="Covid 19">Covid 19</option>
													<option value="Surgery">Surgery</option>
													<option value="Cardiology">Cardiology</option>
												</datalist>
											</div>
										</div>
	
									<div class="text-center">
										<button id="add-procedures-button" type="submit" class="btn btn-primary" style="background-color: rgb(89, 5, 168);">Add Procedure<i class="icon-paperplane ml-2"></i></button>
									</div>
								</form>
								<br/>
							</div>

						</div>

						<div class="collapse show" id="therapy-box">
							<form id="therapy-details-form">
								<div class="card-body py-0">
									</br>
									<div class="form-group row">
										<label id="card-label-first" class="col-lg-3 col-form-label">Therapy</label>
										<div class="col-lg-9">
											<input  id="therapy-data" list="therapy-list" type="text" class="form-control" placeholder="Search Therapy">
											<datalist id="therapy-list">
											</datalist>
										</div>
									</div>
								</div>	
								<div class="text-center">
									<button id="add-therapy-button" type="submit" class="btn btn-primary" style="background-color: rgb(89, 5, 168);">Add Therapy<i class="icon-paperplane ml-2"></i></button>
								</div>
							</form>
							<br/>
						</div>

						<!-- Basic datatable -->
						<div id="drugs-table-box" class="card">
							<table class="table datatable-basic" id="drugsTable">
								<thead>
									<tr>
										<th id="table-label">Name</th>
										<th id="table-label">Dose</th>
										<th id="table-label">Freq</th>
										<th id="table-label">Due</th>

									</tr>
								</thead>
								<tbody>
									<!-- <tr>
										<td id="table-label"><a href="#">Enright</a></td>
										<td id="table-label">Traffic Court Referee</td>
									</tr>
									<tr>
										<td id="table-label">Weible</td>
										<td id="table-label"><a href="#">Airline Transport Pilot</a></td>
									</tr> -->
								</tbody>
							</table>

							<br>
							<div class="text-center">
								<button id="delete-table-button" type="button" class="btn btn-primary" style="background-color: rgb(89, 5, 168);">Delete All Records<i class="icon-paperplane ml-2"></i></button>
							</div>
							<br>

						</div>
						<!-- /basic datatable -->

					</div>
				</div>
				<!-- /main charts -->

			</div>
			<!-- /content area -->

		</div>
		<!-- /main content -->

	</div>
	<!-- /page content -->

	<script>

		/* starts display patient details */

		let patientName = localStorage.getItem("patientName");
		let patientTitle = localStorage.getItem("patientTitle");
		let patientAge = localStorage.getItem("patientAge");
		let patientGender = localStorage.getItem("patientGender");

		document.getElementById("header-patient-name").innerHTML = `${patientTitle} ${patientName}`;
		document.getElementById("page-two-patient-name").innerHTML = `${patientTitle} ${patientName}`;
		document.getElementById("page-two-patient-age").innerHTML = `Age: ${patientAge}`;
		document.getElementById("page-two-patient-gender").innerHTML = `Gender: ${patientGender}`;

		/* ends display patient details */



		/* starts to load drugs.json data to website and create objects array for drugs */

		var xhr = new XMLHttpRequest();
        var drugDataByDrugName = {};
		var drugArray;

		xhr.overrideMimeType("application/json");
		xhr.open('GET', 'data/drugs.json', true);
		xhr.onreadystatechange = function () {
			if (xhr.readyState == 4 && xhr.status == "200") {
				var content = JSON.parse(this.response);
				var	i, count, drugName;

				drugArray = content['drugs'];		 						/* if you need drugs data without name use this */

				for (i = 0, count = drugArray.length; i < count; i++) {		/* get drugs data with name (for search function to perform) */
					drugName = drugArray[i]['drugName'];
					drugDataByDrugName[drugName] = drugArray[i];
				}

				console.log(drugArray);
				console.log(drugDataByDrugName);
			}

		};
		xhr.send(null);

		/* ends to load drugs.json data to website and create objects array for drugs */



		/* starts added drugs.json data to options of datalist in Drug input field */

		function getDrugsToDrugField() {
			var url, drugOption;
			url = 'data/drugs.json';

			$.getJSON(url, function(data) {
				$(data.drugs).each(function() {     					/* populate the drugs datalist */
					drugOption = `<option value="${this.drugName}">${this.drugName}</option>`;
					$('#drug-list').append(drugOption);
				});
			});
		}

		window.onload = getDrugsToDrugField();

		/* ends added drugs.json data to options of datalist in Drug input field */



		/* starts autofill default data of drugs */

		var drugNameController = document.getElementById("drug-data");

		drugNameController.oninput = function() {
			var drugNameInDrugField = document.getElementById("drug-data").value;

			window.localStorage.setItem("drugName", drugNameInDrugField)

			console.log(drugNameInDrugField);
			console.log(drugDataByDrugName[drugNameInDrugField]);
			
			if (drugNameInDrugField && drugDataByDrugName[drugNameInDrugField]) {
				document.getElementById("dose-data").value = drugDataByDrugName[drugNameInDrugField].defaultDose;
				document.getElementById("freq-data").value = drugDataByDrugName[drugNameInDrugField].defaultFreq;
				document.getElementById("due-data").value = drugDataByDrugName[drugNameInDrugField].defaultDue;
			} else if (drugNameInDrugField != null) {
				document.getElementById("drug-data").value = null;
				document.getElementById("dose-data").value = " ";
				document.getElementById("freq-data").value = " ";
				document.getElementById("due-data").value = " ";				
			} else {
				
			}

		}

		/* ends autofill default data of drugs */



		/* starts display drug data in the table (when load the web page) */

		var table = document.getElementById("drugsTable");

		var drugsOfPatientFromLocalStorage = JSON.parse(localStorage.getItem("drugsOfPatient") || "[]");

		for (j = 0; j < drugsOfPatientFromLocalStorage.length; j++) {
			var row = table.insertRow(j + 1);
			var nameCell = row.insertCell(0);
			var doseCell = row.insertCell(1);
			var freqCell = row.insertCell(2);
			var dueCell = row.insertCell(3);

			nameCell.innerHTML = drugsOfPatientFromLocalStorage[j].drugNameInDrugField;
			doseCell.innerHTML = drugsOfPatientFromLocalStorage[j].drugDoseInDoseField;
			freqCell.innerHTML = drugsOfPatientFromLocalStorage[j].drugFreqInFreqField;
			dueCell.innerHTML = drugsOfPatientFromLocalStorage[j].drugDueInDueField;
		}
		
		/* ends display drug data in the table (when load the web page) */

			

		/* starts create new drug object using drug data, and set those drug object to patient's drug array (drugOfPatient) */

		var drugDetailsForm = document.getElementById("drug-details-form");
		var drugsOfPatient = [];	/* all the drugs data of a particular patient */
		var drugObject = {};	/* drug object with drugName, drugDose, drugFreq, drugDue and other allergies or some data */
		
		drugDetailsForm.addEventListener("submit", function(e) {
			e.preventDefault();
			
			var drugNameInDrugField = document.getElementById("drug-data").value;
			var drugDoseInDoseField = document.getElementById("dose-data").value;
			var drugFreqInFreqField = document.getElementById("freq-data").value;
			var drugDueInDueField = document.getElementById("due-data").value;

			drugObject = {drugNameInDrugField, drugDoseInDoseField, drugFreqInFreqField, drugDueInDueField }

			drugsOfPatient = drugsOfPatientFromLocalStorage;								/* set local storage drugs data to new array */
			drugsOfPatient.push(drugObject);

			window.localStorage.setItem("drugsOfPatient", JSON.stringify(drugsOfPatient));		/* store drugs of patient to local storage */

			console.log(drugObject);
			console.log(drugsOfPatient);

			/* starts display drug data in the table (when add a drug using the form)*/

			var row = table.insertRow(1);
			var nameCell = row.insertCell(0);
			var doseCell = row.insertCell(1);
			var freqCell = row.insertCell(2);
			var dueCell = row.insertCell(3);

			var drugsOfPatientFromLocalStorageInsideAddDrugFunction = JSON.parse(localStorage.getItem("drugsOfPatient") || "[]");	/* get drugs of patient from local storage */

			for (j = 0; j < drugsOfPatientFromLocalStorage.length; j++) {
				nameCell.innerHTML = drugsOfPatientFromLocalStorageInsideAddDrugFunction[j].drugNameInDrugField;
				doseCell.innerHTML = drugsOfPatientFromLocalStorageInsideAddDrugFunction[j].drugDoseInDoseField;
				freqCell.innerHTML = drugsOfPatientFromLocalStorageInsideAddDrugFunction[j].drugFreqInFreqField;
				dueCell.innerHTML = drugsOfPatientFromLocalStorageInsideAddDrugFunction[j].drugDueInDueField;
			}
			
			/* ends display drug data in the table (when add a drug using the form) */

			swal("Drug Added!" , `Drug Name: ${drugNameInDrugField}`, "success").then(function() {
				location.reload();
			});
			
		})

		/* ends create new drug object using drug data, and set those drug object to patient's drug array (drugOfPatient) */



		/* starts delete all patient's data of drugs from local storage */

		var deleteAllTableDrugsData = document.getElementById("delete-table-button");
		
		deleteAllTableDrugsData.addEventListener("click", function(e) {
			e.preventDefault();

			localStorage.removeItem("drugsOfPatient");

			location.reload();
		})

		/* starts delete all patient's data of drugs from local storage */



		/* starts display drug form, test form, procedures from and therapy form */

		var drugsBtn = document.getElementById("drugs-button");
		var drugsBox = document.getElementById("drugs-box");

		var testsBtn = document.getElementById("tests-button");
		var testsBox = document.getElementById("tests-box");

		var proceduresBtn = document.getElementById("procedures-button");
		var proceduresBox = document.getElementById("procedures-box");
		
		var therapyBtn = document.getElementById("therapy-button");
		var therapyBox = document.getElementById("therapy-box");

		var drugsTableBox = document.getElementById("drugs-table-box");

		drugsBox.style.display = "block";
		drugsTableBox.style.display = "block";
		testsBox.style.display = "none";
		proceduresBox.style.display = "none";
		therapyBox.style.display = "none";

		drugsBtn.addEventListener("click", function() {
			if (drugsBox.style.display === "none") {
				drugsBox.style.display = "block";
				drugsTableBox.style.display = "block";
				testsBox.style.display = "none";
				proceduresBox.style.display = "none";
				therapyBox.style.display = "none";
			}

			drugsBox.style.display = "block";
			drugsTableBox.style.display = "block";
			testsBox.style.display = "none";
			proceduresBox.style.display = "none";
			therapyBox.style.display = "none";
		})

		testsBtn.addEventListener("click", function() {
			if (testsBox.style.display === "none") {
				testsBox.style.display = "block";
				drugsBox.style.display = "none";
				drugsTableBox.style.display = "none";
				proceduresBox.style.display = "none";
				therapyBox.style.display = "none";
			}
		})

		proceduresBtn.addEventListener("click", function() {
			if (proceduresBox.style.display === "none") {
				proceduresBox.style.display = "block";
				drugsBox.style.display = "none";
				drugsTableBox.style.display = "none";
				testsBox.style.display = "none";
				therapyBox.style.display = "none";

				console.log("working procedure");
			}
		})

		therapyBtn.addEventListener("click", function() {
			if (therapyBox.style.display === "none") {
				therapyBox.style.display = "block";
				drugsBox.style.display = "none";
				drugsTableBox.style.display = "none";
				testsBox.style.display = "none";
				proceduresBox.style.display = "none";

				console.log("working therapy");
			}
		})

		/* ends display drug form, test form, procedures from and therapy form */



		/* starts update and delete the relevant drug data in the table */

		let updatingDrugDataDrugName = localStorage.getItem("drugName");
		let updatingDrugDataDrugDose = localStorage.getItem("drugDose");
		let updatingDrugDataDrugFreq = localStorage.getItem("drugFreq");
		let updatingDrugDataDrugDue = localStorage.getItem("drugDue");

		document.getElementById("drug-data").value = updatingDrugDataDrugName;
		document.getElementById("dose-data").value = updatingDrugDataDrugDose;
		document.getElementById("freq-data").value = updatingDrugDataDrugFreq;
		document.getElementById("due-data").value = updatingDrugDataDrugDue;

		function deleteTheDrugFromTable(drugRow) {
			var deleteDrugName = drugRow.querySelectorAll("td")[0].innerText;
			var deleteDrugDose = drugRow.querySelectorAll("td")[1].innerText;
			var deleteDrugFreq = drugRow.querySelectorAll("td")[2].innerText;
			var deleteDrugDue = drugRow.querySelectorAll("td")[3].innerText;

			for(var i =0,row;row = table.rows[i];i++){
				var col = row.cells;

				var drugNameInDrugField = col[0].innerHTML; 
				var drugDoseInDoseField = col[1].innerHTML;
				var drugFreqInFreqField = col[2].innerHTML; 
				var drugDueInDueField = col[3].innerHTML;

				if (deleteDrugName === drugNameInDrugField && deleteDrugDose === drugDoseInDoseField && deleteDrugFreq === drugFreqInFreqField && deleteDrugDue === drugDueInDueField) {
					
					var drugArray = JSON.parse(localStorage.getItem('drugsOfPatient'));

					drugArray.splice((i-1), 1);

					console.log(drugArray)

					window.localStorage.setItem("drugsOfPatient", JSON.stringify(drugArray));

					break
				}
			}

			drugRow.remove();

			location.reload();

		}

		function updateTheDrugFromTable(drugRow) {
			var updateDrugName = drugRow.querySelectorAll("td")[0].innerText;
			var updateDrugDose = drugRow.querySelectorAll("td")[1].innerText;
			var updateDrugFreq = drugRow.querySelectorAll("td")[2].innerText;
			var updateDrugDue = drugRow.querySelectorAll("td")[3].innerText;

			console.log(`Drug Name: ${updateDrugName}`);
			console.log(`Dose: ${updateDrugDose}`);
			console.log(`Frequent: ${updateDrugFreq}`);
			console.log(`Duration: ${updateDrugDue}`);

			document.getElementById("drug-data").value = updateDrugName;
			document.getElementById("dose-data").value = updateDrugDose;
			document.getElementById("freq-data").value = updateDrugFreq;
			document.getElementById("due-data").value = updateDrugDue;

			window.localStorage.setItem("drugName", updateDrugName)
			window.localStorage.setItem("drugDose", updateDrugDose)
			window.localStorage.setItem("drugFreq", updateDrugFreq)
			window.localStorage.setItem("drugDue", updateDrugDue)

			deleteTheDrugFromTable(drugRow);
		}

		$("#drugsTable tr").click(function() {
			swal({ 
				title:"Drug Selected!", 
				text: `${$(this).children("td").html()}`, 
				icon: "success",
				buttons: {
					cancel: "Cancel",
					edit: "Edit",
					delete: "Delete",
				}
			}).then((value) => {
				switch (value) {
			
					case "delete":
						swal({
							title: "Do You Really Need To Remove The Drug?", 
							text: `${$(this).children("td").html()}`, 
							icon: "warning",
							buttons: {
								cancel: "No",
								yes: "Yes",
							}
						}).then((value) => {
							switch (value) {
								case "yes": 
									deleteTheDrugFromTable(this);
									swal(`Removed the drug`, {
										buttons: false,
										timer: 1000,
									});
									break;

								default:
								swal(`Drug is safe!!!`, {
									buttons: false,
									timer: 1000,
								});
							}
						})
						break;
				
					case "edit":
						window.location.replace("/a_patient.html#drug-update-redirect-div");
						updateTheDrugFromTable(this);
						break;
				
					default:
					swal(`Drug is safe!!!`, {
						buttons: false,
						timer: 1000,
					});
				}
			});
		});

		/* ends update and delete the relevant drug data in the table */



		/* starts get tests data from tests.json file */

		var xhrt = new XMLHttpRequest();
        var testDataByTestName = {};
		var testArray;

		xhrt.overrideMimeType("application/json");
		xhrt.open('GET', 'data/tests.json', true);
		xhrt.onreadystatechange = function () {
			if (xhrt.readyState == 4 && xhrt.status == "200") {
				var content = JSON.parse(this.response);
				var	i, count, testName;

				testArray = content['tests'];		 						/* if you need test data without name use this */

				for (i = 0, count = testArray.length; i < count; i++) {		/* get test data with name (for search function to perform) */
					testName = testArray[i]['testName'];
					testDataByTestName[testName] = testArray[i];
				}

				console.log(testArray);
				console.log(testDataByTestName);
			}

		};
		xhrt.send(null);

		/* ends get tests data from tests.json file */



		/* starts added tests.json data to options of datalist in Test input field */

		function getTestsToTestField() {
			var url, testOption;
			url = 'data/tests.json';

			$.getJSON(url, function(data) {
				$(data.tests).each(function() {     					/* populate the tests datalist */
					testOption = `<option value="${this.testName}">${this.testName}</option>`;
					$('#test-list').append(testOption);
				});
			});
		}

		window.onload = getTestsToTestField();

		/* ends added tests.json data to options of datalist in Test input field*/



		/* starts added tests.json subTest data to options of datalist in Test input field */

		var testNameController = document.getElementById("test-data");

		testNameController.oninput = function() {
			var drugNameInDrugField = document.getElementById("test-data").value;

			window.localStorage.setItem("tetsName", drugNameInDrugField)

			console.log(drugNameInDrugField);
			console.log(testDataByTestName[drugNameInDrugField]);
			
			if (drugNameInDrugField && testDataByTestName[drugNameInDrugField]) {

				var subTestArray, subTestOption, i;

				subTestArray = testDataByTestName[drugNameInDrugField].subTestNames;

				for (i = 0; i < subTestArray.length; i++) {
					subTestOption = `<option value="${subTestArray[i]}">${subTestArray[i]}</option>`;
					$("#sub-test-list").append(subTestOption);					
				}
				

			} else {
				document.getElementById("test-subcategory-data").value = " ";
				document.getElementById("test-data").value = " ";
				$("#sub-test-list").replace(); // cleare past options
			}

		}

		/* ends added tests.json subTest data to options of datalist in Test input field */


	</script>

</body>
</html>
